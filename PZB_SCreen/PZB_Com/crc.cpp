#include "stdio.h"
#include "crc.h"

/*CRC32, CRC余式表, 根据0x1EDC6F41计算得到**/
static volatile const uint32_t SCtable[256] = { 0x0U, 0x1edc6f41U, 0x3db8de82U, 0x2364b1c3U, 0x7b71bd04U, 0x65add245U, 0x46c96386U, 0x58150cc7U, 0xf6e37a08U, 0xe83f1549U, 0xcb5ba48aU, 0xd587cbcbU,
        0x8d92c70cU, 0x934ea84dU, 0xb02a198eU, 0xaef676cfU, 0xf31a9b51U, 0xedc6f410U, 0xcea245d3U, 0xd07e2a92U, 0x886b2655U, 0x96b74914U, 0xb5d3f8d7U, 0xab0f9796U, 0x5f9e159U,  0x1b258e18U,
        0x38413fdbU, 0x269d509aU, 0x7e885c5dU, 0x6054331cU, 0x433082dfU, 0x5deced9eU, 0xf8e959e3U, 0xe63536a2U, 0xc5518761U, 0xdb8de820U, 0x8398e4e7U, 0x9d448ba6U, 0xbe203a65U, 0xa0fc5524U,
        0xe0a23ebU , 0x10d64caaU, 0x33b2fd69U, 0x2d6e9228U, 0x757b9eefU, 0x6ba7f1aeU, 0x48c3406dU, 0x561f2f2cU, 0xbf3c2b2U,  0x152fadf3U, 0x364b1c30U, 0x28977371U, 0x70827fb6U, 0x6e5e10f7U, 0x4d3aa134U,
        0x53e6ce75U, 0xfd10b8baU, 0xe3ccd7fbU, 0xc0a86638U, 0xde740979U, 0x866105beU, 0x98bd6affU, 0xbbd9db3cU, 0xa505b47dU, 0xef0edc87U, 0xf1d2b3c6U, 0xd2b60205U, 0xcc6a6d44U, 0x947f6183U,
        0x8aa30ec2U, 0xa9c7bf01U, 0xb71bd040U, 0x19eda68fU, 0x731c9ceU,  0x2455780dU, 0x3a89174cU, 0x629c1b8bU, 0x7c4074caU, 0x5f24c509U, 0x41f8aa48U, 0x1c1447d6U, 0x2c82897U,  0x21ac9954U, 0x3f70f615U,
        0x6765fad2U, 0x79b99593U, 0x5add2450U, 0x44014b11U, 0xeaf73ddeU, 0xf42b529fU, 0xd74fe35cU, 0xc9938c1dU, 0x918680daU, 0x8f5aef9bU, 0xac3e5e58U, 0xb2e23119U, 0x17e78564U, 0x93bea25U,
        0x2a5f5be6U, 0x348334a7U, 0x6c963860U, 0x724a5721U, 0x512ee6e2U, 0x4ff289a3U, 0xe104ff6cU, 0xffd8902dU, 0xdcbc21eeU, 0xc2604eafU, 0x9a754268U, 0x84a92d29U, 0xa7cd9ceaU, 0xb911f3abU,
        0xe4fd1e35U, 0xfa217174U, 0xd945c0b7U, 0xc799aff6U, 0x9f8ca331U, 0x8150cc70U, 0xa2347db3U, 0xbce812f2U, 0x121e643dU, 0xcc20b7cU,  0x2fa6babfU, 0x317ad5feU, 0x696fd939U, 0x77b3b678U,
        0x54d707bbU, 0x4a0b68faU, 0xc0c1d64fU, 0xde1db90eU, 0xfd7908cdU, 0xe3a5678cU, 0xbbb06b4bU, 0xa56c040aU, 0x8608b5c9U, 0x98d4da88U, 0x3622ac47U, 0x28fec306U, 0xb9a72c5U,  0x15461d84U,
        0x4d531143U, 0x538f7e02U, 0x70ebcfc1U, 0x6e37a080U, 0x33db4d1eU, 0x2d07225fU, 0xe63939cU,  0x10bffcddU, 0x48aaf01aU, 0x56769f5bU, 0x75122e98U, 0x6bce41d9U, 0xc5383716U, 0xdbe45857U,
        0xf880e994U, 0xe65c86d5U, 0xbe498a12U, 0xa095e553U, 0x83f15490U, 0x9d2d3bd1U, 0x38288facU, 0x26f4e0edU, 0x590512eU,  0x1b4c3e6fU, 0x435932a8U, 0x5d855de9U, 0x7ee1ec2aU, 0x603d836bU,
        0xcecbf5a4U, 0xd0179ae5U, 0xf3732b26U, 0xedaf4467U, 0xb5ba48a0U, 0xab6627e1U, 0x88029622U, 0x96def963U, 0xcb3214fdU, 0xd5ee7bbcU, 0xf68aca7fU, 0xe856a53eU, 0xb043a9f9U, 0xae9fc6b8U,
        0x8dfb777bU, 0x9327183aU, 0x3dd16ef5U, 0x230d01b4U, 0x69b077U,   0x1eb5df36U, 0x46a0d3f1U, 0x587cbcb0U, 0x7b180d73U, 0x65c46232U, 0x2fcf0ac8U, 0x31136589U, 0x1277d44aU, 0xcabbb0bU,  0x54beb7ccU,
        0x4a62d88dU, 0x6906694eU, 0x77da060fU, 0xd92c70c0U, 0xc7f01f81U, 0xe494ae42U, 0xfa48c103U, 0xa25dcdc4U, 0xbc81a285U, 0x9fe51346U, 0x81397c07U, 0xdcd59199U, 0xc209fed8U, 0xe16d4f1bU,
        0xffb1205aU, 0xa7a42c9dU, 0xb97843dcU, 0x9a1cf21fU, 0x84c09d5eU, 0x2a36eb91U, 0x34ea84d0U, 0x178e3513U, 0x9525a52U,  0x51475695U, 0x4f9b39d4U, 0x6cff8817U, 0x7223e756U, 0xd726532bU,
        0xc9fa3c6aU, 0xea9e8da9U, 0xf442e2e8U, 0xac57ee2fU, 0xb28b816eU, 0x91ef30adU, 0x8f335fecU, 0x21c52923U, 0x3f194662U, 0x1c7df7a1U, 0x2a198e0U, 0x5ab49427U,  0x4468fb66U, 0x670c4aa5U,
        0x79d025e4U, 0x243cc87aU, 0x3ae0a73bU, 0x198416f8U, 0x75879b9U, 0x5f4d757eU, 0x41911a3fU,  0x62f5abfcU, 0x7c29c4bdU, 0xd2dfb272U, 0xcc03dd33U, 0xef676cf0U, 0xf1bb03b1U, 0xa9ae0f76U,
        0xb7726037U, 0x9416d1f4U, 0x8acabeb5U }; /**< CRC32计算公式 */

/**
 *   @brief CRC8计算函数
 *   @param ptr 数据地址
 *   @param len 数据长度
 *   @return CRC计算结果
 *   @par 流程图
 *        @image html ccitt_crc8.svg
 */
uint32_t ccitt_crc8(uint8_t *ptr, uint32_t len)
{
    /* 变量初始化 */
    uint32_t crc = 0U;

    /* 入参防护 */
    if (ptr != NULL)
    {
        while (len != 0U)
        {
            len -= 1U;
            crc = (crc << 8U) ^ SCtable[((crc >> 24U) & 0xFFU) ^ ((*ptr) & 0xFF)];
            ptr++;
        }
    }
    /* 返回CRC */
    return crc;
}

